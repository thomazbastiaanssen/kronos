---
title: "Benchmarking Kronos and other circadian packages"
author: "Sarah-Jane Leigh & Thomaz F.S. Bastiaanssen"
date: "2022-10-26"
output:
  md_document:
    variant: gfm
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load, message = F, warning = F}
library(tidyverse)

#devtools::install_github("thomazbastiaanssen/kronos") 
library(kronos)

#install.packages('limorhyde')
library(limorhyde)

library(cosinor)
library(cosinor2)

```

```{r load and clean, message = F, warning = F}
source("00_load_and_clean_WGS.R")

```

```{r run tools, message = F, warning = F}
source("01a_run_kronos.R")
source("01b_run_jtk_cycle.R")
source("01c_run_limorhyde.R")
source("01d_run_cosinor2.R")
```

```{r assess tools}

head(res_kronos)
head(res_jtk)
head(res_limo)
head(res_cosinor2)

res_tot = do.call(cbind, list(res_kronos, res_jtk, res_limo, res_cosinor2))
colnames(res_tot) = paste(colnames(res_tot), c(rep("kronos", ncol(res_kronos)),
                                               rep("jtk",    ncol(res_jtk)),
                                               rep("limo",    ncol(res_limo)),
                                               rep("cosinor2",    ncol(res_cosinor2))), sep = "_")


```

```{r plot stats}


par(mfcol = c(2, 2))
hist(res_kronos$p.val, breaks = 20)
hist(res_jtk$p.val, breaks = 20)
hist(res_cosinor2$p.val, breaks = 20)
hist(res_limo$p.val, breaks = 20)


```

```{r plot tools}
res_tot %>%
  rownames_to_column("ID") %>% 
  dplyr::select(!gene_id_limo) %>% 
  pivot_longer(!ID) %>% 
  separate(name, into = c("parameter", "program"), sep = "_") %>% 
  filter(parameter %in% c("p.val")) %>% 
  filter(value < 0.2) %>% 
  ggplot() +
  aes(x = value, y = ID) +
  geom_point(alpha = 0.5) +
  facet_wrap(~program, ncol = 4) +
  theme_bw()
  
```